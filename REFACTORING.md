# NixOS設定のリファクタリング計画

## 1. 新しいディレクトリ構造

```
.
├── flake.nix
├── lib/                    # 共通のユーティリティ関数
│   └── default.nix
├── hosts/                  # ホスト固有の設定
│   └── desktop/           # デスクトップマシンの設定
│       ├── default.nix    # メインの設定
│       ├── hardware.nix   # ハードウェア設定
│       └── nvidia.nix     # NVIDIA固有の設定
├── modules/               # 再利用可能なモジュール
│   ├── nixos/            # NixOS用モジュール
│   │   ├── desktop/      # デスクトップ環境
│   │   └── base/         # 基本システム設定
│   └── home/             # Home Manager用モジュール
│       ├── desktop/      # デスクトップアプリケーション
│       └── cli/          # CLIツール
└── config/               # 共通の設定ファイル
    ├── user.nix         # ユーザー情報
    └── fcitx/           # 入力メソッドの設定
```

## 2. 主な変更点

### 2.1 設定の分離と整理

- **ユーザー情報の分離**
  - 現在: flake.nixに直接記述
  - 改善後: config/user.nixに分離
  - 理由: 設定の再利用性向上と管理のしやすさ

- **ハードウェア設定の分離**
  - 現在: hikuo-deskotp.nixに混在
  - 改善後: hosts/desktop/hardware.nixとhosts/desktop/nvidia.nixに分離
  - 理由: 設定の明確な分類と再利用性の向上

- **モジュール化の改善**
  - デスクトップ環境の設定を分離
  - CLIツールとGUIツールの明確な区分
  - 共通の基本設定をbase/に集約

### 2.2 命名規則の統一

- ファイル名のタイプミス修正（deskotp → desktop）
- 一貫性のある命名規則の適用
- 明確な意図を示すディレクトリ名とファイル名

## 3. 実装手順

1. 新しいディレクトリ構造の作成
2. ユーザー設定の移行
3. システム設定の再構成
   - 基本設定の移行
   - ハードウェア設定の分離
   - デスクトップ環境設定の整理
4. Home Manager設定の再構成
   - CLIツールの整理
   - GUIツールの整理
5. flake.nixの更新

## 4. 期待される効果

- 設定の可読性向上
- メンテナンス性の改善
- 再利用性の向上
- エラーの発見と修正が容易に
- 新しい設定の追加が簡単に

## 5. 注意点

- 既存の設定の動作を維持
- 移行時の後方互換性の確保
- 適切なドキュメンテーションの提供